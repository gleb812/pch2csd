opcode OscDual, 0, KKKKKKKKKKKK
; Part Mode not implemented yet!
;

	kMainKnob, kFine, kModSq, kModPh, kKBT, kModPitch, kPW, kPhase, kLevSq, kLevSaw, kSub, kSoft xin
	
	if kKBT == 1 then goto KBT
		kFreq = 329.63 ; Default E4
		goto Play 
KBT:
		kFreq = gkLastNote
Play:

	kfn2 = kSoft + 10 ; 10 - Ideal Square, 11 -  Smooth Square

	aPW zar 1; CHANGE		
	aPh zar 1; CHANGE
	aSync zar 2; CHANGE
	kPitch zkr 2 ; CHANGE 
	kMod zkr 1 ; CHANGE 

	; Proverit' amplitudu
	kFine = cent(kFine)
	aph1,async syncphasor kFreq+kMainKnob*kFine+kPitch, aSync  
	aoutS1 tableikt aph1, kfn1 ; SAW1
	aoutS2 tableikt aph1+kPW+kModSq*aPW, kfn1 ; SAW2
	
	aoutSq = (aoutS1 + aoutS2) * .5

	aph2,async syncphasor kFreq+kMainKnob*kFine+kPitch, aSync  
	aoutSa tableikt aph2+kPhase+aPh*kModPh, kfn1 ; SAW


	aphS,async2 syncphasor kFreq+kMainKnob*kFine+kPitch, aSync 
	aoutS tableikt aphS, kfn2  ; SUB SQUARE

	aout = aoutS * kSub + aoutSq * kLevSq + aoutSa * kLevSaw
	zaw aout, 2  ; CHANGE 
endop