opcode OscB, 0, KKKKKK
; Part Mode not implemented yet!
; FM Lin / FM Trk not implemented yet!
;

	kfn, kMainKnob, kFine, kModFM, kShape, kKBT xin
	
	if kKBT == 1 then goto KBT
		kFreq = 329.63 ; Default E4
		goto Play 
KBT:
		kFreq = gkLastNote
Play:

	aFM zar 1; CHANGE
	aSync zar 2; CHANGE
	kPitch zkr 2 ; CHANGE 
	kMod zkr 1 ; CHANGE 
	kModFM zkr 2; CHANGE

	; Proverit' amplitudu
	kFine = cent(kFine)
	aph,async syncphasor kFreq+kMainKnob*kFine+kPitch+aFM*kModFM, aSync  
	aout tableikt aph, kfn

	if kfn == 4 then goto PWM
	if kfn == 5 then goto Dual
	goto Run

	aph2,async2 syncphasor kFreq+kMainKnob*kFine+kPitch+aFM*kModFM + kShape, aSync 
	aout2 tableikt aph2, kfn  ; ALWAYS SAW

PWM:
	aout = (aout + aout2)*.5
	goto Run
Dual:
	aout = (aout - aout2)*.5	

	Run:
	zaw aout, 2  ; CHANGE 
endop