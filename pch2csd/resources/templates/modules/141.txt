;@ ins k k
;@ outs k
opcode CtrlSend, 0, kkkkkk
  kCtrl, kVal, kCh, ksend, kvalue, kout xin

  ; TODO CHECK modulation lev
    kSend zkr ksend
    kValue zkr kvalue
    kOut init 0

    kValue limit kVal + kValue * 64, 0, 127
    kTrig changed kValue
    if kTrig == 0 goto Halt
    	midiout 176, kCh, kCtrl, kValue ; GENERIC CC MESSAGE
      kOut = 1
  Halt:
    zkw kOut, kout
    kout = 0 ; reset after send
  endop
